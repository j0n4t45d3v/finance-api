<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings
    xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/orm_2_2.xsd"
    version="2.2">
  <package>br.com.managementfinanceapi</package>

  <named-query name="Balance.findAllBalancesWithMonthANdYearGreater">
    <query>select b from Balance b where b.month > :month and b.year > :year and b.user.id = :userId</query>
  </named-query>

  <named-query name="Category.findTotalByCategory">
    <query>
      SELECT
      new br.com.managementfinanceapi.application.core.domain.category.dto.TotalByCategoryView(
      c.name,
      c.creditLimit,
      SUM(t.amount) as value
      )
      FROM
      Category c
      INNER JOIN
      Transaction t
      ON t.category.id = c.id AND
      t.user.id = c.user.id
      WHERE
      MONTH(t.date) = :month AND
      YEAR(t.date) = :year AND
      c.user.id = :userId
      GROUP BY c.name, c.creditLimit
      ORDER BY value, c.name
    </query>
  </named-query>

</entity-mappings>